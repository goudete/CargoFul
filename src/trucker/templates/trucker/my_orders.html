{% extends 'trucker/base.html'%}

{% block content %}
{% load trucker_tags %}

<!-- Welcome and Successful order messages -->
{% if messages %}
{% for message in messages %}
{% if message.level == DEFAULT_MESSAGE_LEVELS.INFO %}
<div class="row justify-content-center alert alert-primary pt-3 pb-3" role="alert">
  <div class="col-md-8">
    <h4>{{ message }}</h4>
  </div>
</div>
{% endif %}

{% if message.level == DEFAULT_MESSAGE_LEVELS.SUCCESS %}
<div class="row justify-content-center alert alert-primary pt-3 pb-3" role="alert">
  <div class="col-md-8">
    <h4>{{ message }}</h4>
  </div>
</div>
{% endif %}

{% endfor %}
{% endif %}
<!-- messages end here -->
<div class="row justify-content-center mt-5">
  <div class="col-md-10">
    <h1>My Jobs</h1>
  </div>
</div>
<!-- start of table -->
<div class="row justify-content-center pt-2">
  <div class="col-md-10">
    <div class="card">
    <table class="table table-striped">
      <thead>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <tr>
          <th scope = 'col'>Order Number</th>
          <th scope="col">Shipping Company</th>
          <th scope = 'col'>Pickup Adress</th>
          <th scope = 'col'>Delivery Address</th>
          <th scope = 'col'>Distance</th>
          <th scope = 'col'>Pickup Date</th>
          <th scope = 'col'>Pickup Time</th>
          <th scope = 'col'>Status</th>
          <th scope="col">Price</th>
        </tr>
      </thead>
      <tbody>

        {% for my in my_orders %}
        <tr>
          <td>{{ my.customer_order_no }}</td>
          <td>{{ my.shipping_company.user.profile.company_name }}</td>
          <td>{{ my.pickup_address }}</td>
          <td>{{ my.delivery_address }}</td>
          <td>{{ my.distance }} KM</td>
          <td>{{ my.pickup_date }}</td>
          <td>{{ my.pickup_time }}</td>
          <td>
            {% if my.status == 1 %}
            <form action = 'update_status' method = 'post'>{% csrf_token %}
                <select class = 'form-control pl-5 pr-5' id = 'status' name="status">
              		<option value='1' selected>Booked</option>
              		<option value="2">In Transit</option>
              		<option value="3">Delivered</option>
            		</select>
                <input type = 'number' id = 'order_id' name = 'order_id' value = {{my.id}} hidden = 'true'>
                <div class="row justify-content-center">
                  <div class="btn-group" role="group">
                      <button type="submit" class="btn btn-secondary mt-2">Update</button>
                  </div>
                </div>
            </form>
            {% elif my.status == 2 %}
            <form action = 'update_status' method = 'post'>{% csrf_token %}
                <select class = 'form-control' id = 'status' name="status">
              		<option value="2" selected>In Transit</option>
              		<option value="3">Delivered</option>
            		</select>
                <input type = 'number' id = 'order_id' name = 'order_id' value = {{my.id}} hidden = 'true'>
                <div class="row justify-content-center">
                  <div class="btn-group" role="group">
                      <button type="submit" class="btn btn-secondary mt-2">Update</button>
                  </div>
                </div>
            </form>
            {% elif my.status == 3 %}
            <form action = 'update_status' method = 'post'>{% csrf_token %}
                <select class = 'form-control' id = 'status' name="status">
              		<option value="3" selected>Delivered</option>
            		</select>
                <input type = 'number' id = 'order_id' name = 'order_id' value = {{my.id}} hidden = 'true'>
                <div class="row justify-content-center">
                  <div class="btn-group" role="group">
                      <button type="submit" class="btn btn-secondary mt-2">Update</button>
                  </div>
                </div>
            </form>
            {% endif %}
          </td>
          <td>{{ my.price }}</td>
        </tr>
        {% endfor %}

      </tbody>
    </table>
    </div>
  </div>
</div>

<script>
  var geocoder = new google.maps.Geocoder;

      function geocodeLatLng(geocoder) {
        var input = document.getElementById('latlng').value;
        var latlngStr = input.split(',', 2);
        var latlng = {lat: parseFloat(latlngStr[0]), lng: parseFloat(latlngStr[1])};
        geocoder.geocode({'location': latlng}, function(results, status) {
          if (status === 'OK') {
            if (results[0]) {
              map.setZoom(11);
              var marker = new google.maps.Marker({
                position: latlng,
                map: map
              });
              infowindow.setContent(results[0].formatted_address);
              infowindow.open(map, marker);
            } else {
              window.alert('No results found');
            }
          } else {
            window.alert('Geocoder failed due to: ' + status);
          }
        });
      }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap">
</script>

{% endblock %}
