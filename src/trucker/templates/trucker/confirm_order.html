{% extends 'trucker/base.html'%}
{% load static %}
{% block content %}
<div class="container">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

  <div class="row justify-content-center mt-5">
    <div class="col-md-8">
      <h1>Confirm Order</h1>
    </div>
  </div>

  <div class="row justify-content-center mt-5">
    <div id='map'></div>
    <div id = 'mark1' style='background-image: url("{% static "imgs/CargoFulLogo-12.png" %}");'></div>
    <div id = 'mark2' style='background-image: url("{% static "imgs/CargoFulLogo-12.png" %}");'></div>
  </div>

  <form action = 'order_accepted' method = "post">
    {% csrf_token %}

    <div class="row justify-content-center">
      <div class="col-8">
        <h5>Pickup Address</h5>
        <input class = 'form-control' id = 'addy'  type = 'text' value = '{{order.pickup_address}}' size = '60' readonly>
      </div>
    </div>

    <div class="row justify-content-center">
      <div class="col-8">
        <h5>Delivery Address</h5>
        <input class = 'form-control' id = 'addy'  type = 'text' value = '{{order.delivery_address}}' size = '60' readonly>
      </div>
    </div>

    <div class="row justify-content-center mt-4">
      <div class="col-4">
        <h5>Pickup Date</h5>
        <input class = 'form-control' id = 'date'  type="text" value = "{{order.pickup_date}}" size = '60' readonly/>
      </div>
      <div class="col-4">
        <h5>Pickup Time</h5>
        <input class = 'form-control' id = 'time'  type="text" value = "{{order.pickup_time}}" size = '60' readonly/>
      </div>
    </div>

    <div class="row justify-content-center mt-4">
      <div class="col-4">
        <h5>Truck Type</h5>
        <input class = 'form-control' id = 'truck_type'  type="text" value = "{{order.truck_type}}" size = '60' readonly/>
      </div>
      <div class="col-4">
        <h5>Price</h5>
        <input class = 'form-control' id = 'price'  type="number" step="0.01" value = {{order.price}} size = '60' readonly/>
      </div>

    </div>

    <div class="row justify-content-center mt-4">
      <div class="col-4">
        <h5>Contents</h5>
        <input class = 'form-control' id = 'contents' type="text" value = "{{order.contents}}" size = '60' readonly/>
      </div>
      <div class="col-4">
        <h5>Instructions</h5>
        <input class = 'form-control' id = 'instructions' type="text" value = "{{order.instructions}}" size = '60' readonly/>
      </div>
    </div>

      <!-- hidden value -->
    <input id = 'order_id' name = 'order_id' type = "number" value = {{order.id}} hidden = "true"/>

    <!-- accept or decline order -->
    <div class="row justify-content-center mb-5 mt-5">
      <div class="btn-group">
        <!-- cancel button -->
        <div class="col-5">
          <a href="/trucker" type="button" class="btn btn-danger" aria-pressed="true">Cancel</a>
        </div>
        <!-- confirm order button-->
        <div class="col-5">
          <button type="submit" name="big_submit" class="btn btn-success">Accept</button>
        </div>
      </div>
    </div>
  </form>
  <!-- CounterOfferForm -->
<div class="row justify-content-center mb-5 mt-5">
  <div class="col-4">
    <h5>Counter Offer</h5>
    <form class="form-inline" method="post" action='order_accepted' >
      {% csrf_token %}
      <div class="form-group mx-sm-3">
        <input class = 'form-control' id = 'counter_price' name='counter_price' type="number" step="0.01" size = '20'/>
        <input type="number" name="order_id" value={{ order.id }} hidden='True'/>
      </div>
      <button type="submit" name="counter_submit" class="btn btn-success">Bid</button>
    </form>
  </div>
</div>

  <!-- CounterOfferForm Ends -->
</div>

<script>
mapboxgl.accessToken = 'pk.eyJ1IjoicmZpdGNoIiwiYSI6ImNrN3dqdTYwYjAzNzUzZm85NXRreXo0bTcifQ.SNWvUpiNG9Q7EAQakLFsbw';

var map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/mapbox/light-v10',
  center: [{{mid_long}}, {{mid_lat}}],
  zoom: 3
});

// code from the next step will go here!

var geojson = {
  type: 'FeatureCollection',
  features: [{
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [{{order.pickup_longitude}}, {{order.pickup_latitude}}]
    },
    properties: {
      title: 'Pickup Location',
      description: '{{order.pickup_address}}'
    }
  },
  {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [{{order.delivery_longitude}}, {{order.delivery_latitude}}]
    },
    properties: {
      title: 'Delivery Location',
      description: '{{order.delivery_address}}'
    }
  }]
};

var mark1 = document.getElementById('mark1');
mark1.className = 'marker';
new mapboxgl.Marker(mark1)
  .setLngLat(geojson.features[0].geometry.coordinates)
  .setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups
  .setHTML('<h3>' + geojson.features[0].properties.title + '</h3><p>' + geojson.features[0].properties.description + '</p>'))
  .addTo(map);

var mark2 = document.getElementById('mark2');
mark2.className = 'marker';
new mapboxgl.Marker(mark2)
  .setLngLat(geojson.features[1].geometry.coordinates)
  .setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups
  .setHTML('<h3>' + geojson.features[1].properties.title + '</h3><p>' + geojson.features[1].properties.description + '</p>'))
  .addTo(map);
</script>

{% endblock %}
